<%!
from config import SITE_URL, SITE_DOMAIN
from model.cid import CID_USER, CID_PIC, CID_ICO, CID_WORD, CID_NOTE, CID_QUESTION, CID_PHOTO, CID_VIDEO, CID_AUDIO, CID_SITE
from model.zsite import Zsite, ZSITE_STATE_WAIT_VERIFY, ZSITE_STATE_ACTIVE, ZSITE_STATE_VERIFY 
from model.money import withdraw_open_count, withdraw_max
from model.po import Po
from model.state import STATE_DEL
from model.po_show import po_show_count
from model.pic_review import pic_to_review_count_by_cid
from model.reply import Reply
from model.rss import rss_po_total, RSS_UNCHECK,Rss,RSS_RM,RSS_POED,RSS_RT_PO,RSS_PRE_PO 
from model.event import Event, EVENT_STATE_TO_REVIEW
from model.cid import CID_COM
from model.po_product import product_count
%>\
<!doctype html>\
<head>\
<meta http-equiv="content-type" content="text/html; charset=UTF-8">\
<script src="${js.z}"></script>\
${css.z|n}
${css.god_god|n}
${self.htm_head()}\
<title>${self.htm_title()}</title>\
</head>\
<body>\


<div class="colmask leftmenu">
    <div class="colright">
        <div class="col1wrap">
            <div class="col1">${next.body()}</div>
        </div>
        <div class="col2">${self.col2()}</div>
    </div>
</div>

</body>\

<%def name="col2()">
<%
pic_to_review_count = pic_to_review_count_by_cid(CID_ICO)
%>
<h1><a href="//god.${SITE_DOMAIN}">${SITE_DOMAIN}</a></h1>
<form class="search" action="/zsite/user_search" method="POST">\
<input id="search" type="text" name="input" value="${value or ''}">\
<input class="search_btn" type="submit" value="">\
</form>\
<p class="coltitle">请求</p>


<div>
<a class="cola"
  %if pic_to_review_count > 0:
href="/pic/review${CID_ICO}"
  %elif Zsite.where(cid=CID_USER, state=ZSITE_STATE_WAIT_VERIFY).count() > 0:
href="/zsite/verify${CID_USER}#${Zsite.raw_sql('select max(id) from zsite where state = %s and cid = %s',ZSITE_STATE_WAIT_VERIFY,CID_USER).fetchone()[0] or ''}"
  %else:
href = "/chart"
  %endif
  >

    <span class="R">
        ${Zsite.where(cid=CID_USER, state=ZSITE_STATE_WAIT_VERIFY).count()}
    </span>
    用户认证
</a>
<%
event_to_review_query = Event.where(state=EVENT_STATE_TO_REVIEW)
event_to_review_count = event_to_review_query.count()
event_to_review_max_li = event_to_review_query.order_by('id desc').col_list(1, 0)
event_to_review_max = event_to_review_max_li and event_to_review_max_li[0] or 0
%>
<a class="cola" href="/event/review?${event_to_review_max}"><span class="R">${event_to_review_count}</span>活动审核</a>
<a class="cola" href="/withdraw?${withdraw_max()}"><span class="R">${withdraw_open_count()}</span>提现</a>
<a class="cola tc" href="/test_account" target="_blank">测试账号</a>
</div>



<p class="coltitle">浏览</p>
<a class="cola" href="/user_show_id_list"><span class="R">${Zsite.where('state>=%s', ZSITE_STATE_VERIFY ).where(cid=CID_USER).count()}</span>认证用户</a>
<a class="cola" href="/user_list#${Zsite.raw_sql('select max(id) from zsite where cid=%s',CID_USER).fetchone()[0] or ''}"><span class="R">${Zsite.where('state>=%s', ZSITE_STATE_ACTIVE).where(cid=CID_USER).count()}</span>用户</a>
##<a class="cola" href="/com/${ZSITE_STATE_ACTIVE}"><span class="R">${Zsite.where(cid=CID_COM,state=ZSITE_STATE_ACTIVE).count()}</span>认证公司</a>
<a class="cola" href="/po?${Po.raw_sql('select max(id) from po where zsite_id != user_id').fetchone()[0] or ''}"><span class="R">${Po.where('state>%s', STATE_DEL).where('zsite_id!=user_id').count()}</span>最新发布</a>
<a class="cola" href="/po/zsite?${Po.raw_sql('select max(id) from po where zsite_id=user_id').fetchone()[0] or ''}"><span class="R">${Po.where('state>%s', STATE_DEL).where('zsite_id=user_id').count()}</span>RSS同步</a>
<a class="cola" href="/po/show"><span class="R">${po_show_count()}</span>广播</a>
<a class="cola" href="/event"><span class="R">${Event.where().count()}</span>全部活动</a>
<a class="cola" href="/site"><span class="R">${Zsite.where(cid=CID_SITE).count()}</span>全部小组</a>

<%
count = product_count()
%>
<a class="cola" href="/product?${count}"><span class="R">${count}</span>产品</a>

<a class="cola" href="/com"><span class="R">${Zsite.where(cid=CID_COM).count()}</span>全部公司</a>
<p class="coltitle">RSS文章</p>

<a class="cola" href="/rss_index?${Rss.max_id()}"><span class="R">${rss_po_total(RSS_UNCHECK)}</span>未审核</a>
<a class="cola" href="/rss_index/${RSS_PRE_PO}?${Rss.max_id()}"><span class="R">${rss_po_total(RSS_PRE_PO)}</span>已审核</a>
<a class="cola" href="/rss_index/${RSS_RT_PO}?${Rss.max_id()}"><span class="R">${rss_po_total(RSS_RT_PO)}</span>已审核并全站转发</a>
<a class="cola" href="/rss_index/${RSS_POED}?${Rss.max_id()}"><span class="R">${rss_po_total(RSS_POED)}</span>已发表</a>
<a class="cola" href="/rss_index/${RSS_RM}?${Rss.max_id()}"><span class="R">${rss_po_total(RSS_RM)}</span>已删除</a>

<p class="coltitle">RSS订阅</p>
<a class="cola" href="/rss_gid/0">待订阅</a>
<a class="cola" href="/rss_gid/1">已订阅</a>
<a class="cola" href="/rss_gid/-1">被删除</a>
<a class="cola" href="/rss/new">添加RSS</a>


<p class="coltitle">回复</p>
<a class="cola" href="/reply_list/${CID_USER}?${Reply.raw_sql('select max(id) from reply where cid = %s',CID_USER).fetchone()[0] or ''}"><span class="R">${Reply.where('cid=%s',CID_USER).count()}</span>留言</a>
<a class="cola" href="/reply_list/${CID_NOTE}?${Reply.raw_sql('select max(id) from reply where cid = %s',CID_NOTE).fetchone()[0] or ''}"><span class="R">${Reply.where('cid=%s',CID_NOTE).count()}</span>文章</a>
<a class="cola" href="/reply_list/${CID_WORD}?${Reply.raw_sql('select max(id) from reply where cid = %s',CID_WORD).fetchone()[0] or ''}"><span class="R">${Reply.where('cid=%s',CID_WORD).count()}</span>微博</a>
<a class="cola" href="/reply_list/${CID_QUESTION}?${Reply.raw_sql('select max(id) from reply where cid = %s',CID_QUESTION).fetchone()[0] or ''}"><span class="R">${Reply.where('cid=%s',CID_QUESTION).count()}</span>评论</a>
<a class="cola" href="/reply_list/${CID_PHOTO}?${Reply.raw_sql('select max(id) from reply where cid = %s',CID_PHOTO).fetchone()[0] or ''}"><span class="R">${Reply.where('cid=%s',CID_PHOTO).count()}</span>图片</a>
<a class="cola" href="/reply_list/${CID_VIDEO}?${Reply.raw_sql('select max(id) from reply where cid = %s',CID_VIDEO).fetchone()[0] or ''}"><span class="R">${Reply.where('cid=%s',CID_VIDEO).count()}</span>视频</a>
<a class="cola" href="/reply_list/${CID_AUDIO}?${Reply.raw_sql('select max(id) from reply where cid = %s',CID_AUDIO).fetchone()[0] or ''}"><span class="R">${Reply.where('cid=%s',CID_AUDIO).count()}</span>声音</a>



<p class="coltitle">头像</p>
<a class="cola" 
    %if pic_to_review_count > 0 :
    href="/pic/review${CID_ICO}"
    %else:
    href = "/chart"
    %endif
    ><span class="R">${pic_to_review_count}</span>待审核</a>
<a class="cola tc" href="/pic/reviewed${CID_ICO}/1">已通过</a>
<a class="cola tc" href="/pic/reviewed${CID_ICO}/0">被删除</a>

<p class="coltitle">邮件</p>
<a class="cola tc" href="/weekly/mail">新建</a>
<a class="cola tc" href="/weekly/mail-1">列表</a>

<p class="coltitle">公告</p>
<a class="cola tc" href="/buzz/sys">提交</a>
<a class="cola tc" href="/buzz/sys/init">默认</a>

<p class="coltitle">其它</p>
<a class="cola tc" href="/apply_list">应用列表</a>
<a class="cola tc" href="/trade_list">交易记录</a>
<a class="cola tc" href="/chart">网站报表</a>
<a class="cola tc" href="http://t.cn/aCOG3v" target="_blank">京东返点</a>

</%def>

<%def name="htm_title()">后台</%def>\
<%def name="htm_head()"></%def>\
