<%inherit file="/god/_base.htm" />
<%!
from config import FS_URL 
from yajl import dumps
from model.log_history import LOG_HISTORY_NEW_USER_CID, LOG_HISTORY_NEW_PO_CID, LOG_HISTORY_NEW_PO_USER_CID, LOG_HISTORY_NEW_REPLY_CID
%>
<%def name="htm_head()">
${css.god_chart|n}
<script src="${js.swf}"></script>
</%def>

<%def name="render_chart(cid,data)">
<%
y_max = max(data)
y_min = min(data)
step = max(int((y_max - y_min)/10),1)
values = data
json = {
    "elements": [ 
    {
        "type": "line", "values": data,  "width": 1, "colour": "#3D5C56" } ], "y_axis": { "min": y_min, "max": y_max, "steps": step},
"x_axis": { 
    "colour": "#A2ACBA", "grid-colour": "#D7E4A3", 
    "offset": 'false', "steps": 7
}
}
%>
<div class="chart">
    <div class="chart_title">新增${cat(cid)} 今日 +${pr(cid)}</div>
    <div id="chart${cid}"></div>
<script>
swfobject.embedSWF(
    '/swf/open-flash-chart.swf', "chart${cid}", "100%", "302", "9", "expressInstall.swf",
    {"get-data":"chart${cid}"} 
);
function chart${cid}(){
    return '${dumps(json)|n}' 
}
</script>
</div>
</%def>
<%def name="cat(cid)">
<%
    if cid == LOG_HISTORY_NEW_USER_CID:
        return "用户数"
    elif cid == LOG_HISTORY_NEW_PO_CID:        return "发帖数"
    elif cid == LOG_HISTORY_NEW_PO_USER_CID:        return "发帖人数"
    elif cid == LOG_HISTORY_NEW_REPLY_CID:
        return "回复数"
    else:
        return "神马数"
%>
</%def>
<%def name="pr(cid)">
<%
    if cid == LOG_HISTORY_NEW_USER_CID:
        return num_user
    elif cid == LOG_HISTORY_NEW_PO_CID:
        return num_po
    elif cid == LOG_HISTORY_NEW_PO_USER_CID:
        return num_pouser
    elif cid == LOG_HISTORY_NEW_REPLY_CID:
        return num_reply
    else:
        return "@@"
%>
</%def>


%for data,cid in (incr_user,LOG_HISTORY_NEW_USER_CID),(incr_po,LOG_HISTORY_NEW_PO_CID),(incr_pouser,LOG_HISTORY_NEW_PO_USER_CID),(incr_reply,LOG_HISTORY_NEW_REPLY_CID):
${render_chart(cid,data)}
%endfor

 <p><a href="http://www.alexa.com/siteinfo/42qu.com" target="_blank">Alexa</a></p>
<img src="http://traffic.cn.alexa.com/graph?&w=972&h=256&o=f&c=1&y=r&b=ffffff&r=6m&u=42qu.com&">
