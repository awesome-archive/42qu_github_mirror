<%inherit file="/god/_base.htm" />
<%!
from zkit.time_format import friendly_time
from model.ico import ico_url as _ico_url
from model.zsite import Zsite
from zkit.txt import cnenoverflow
from model.event import EVENT_STATE_DEL, EVENT_STATE_INIT, EVENT_STATE_REJECT, EVENT_STATE_TO_REVIEW, EVENT_STATE_BEGIN, EVENT_STATE_NOW, EVENT_STATE_END
%>
<%def name="htm_head()">
<script>
$('a.yes').live('click', function() {
    var id = this.rel;
    $.postJSON('/event/state/' + id + '/1', function(data){
        next()
    })
})
$('a.no').live('click', function() {
    var id = this.rel;
    var txt = $('#txt' + id).val();
    if(!(txt && txt.length)) {
        alert("请写入理由")
        return false
    }
    $.postJSON('/event/state/' + id + '/0', {"txt":txt}, function(data){
        //next()
    })
})
function next(){
    location='/event/review'
}
</script>
</%def>

% if event:
<%
id = event.id
po = event.po
state = event.state
user = po.user
%>
<div class="sdw">
    <div class="sd c">
        <div id="list_txt">
            <a href="${po.link}" target="_blank">${po.name}</a>
            <p>${cnenoverflow(po.txt, 60)[0]}</p>
            <p>
                <a class="c0" href="${user.link}" target="_blank">${user.name}</a>
                ${friendly_time(po.create_time)}
            </p>
            <p>
<a href="javascript:void(0)" rel="${id}" class="yes">通过</a>
<hr>
<a href="javascript:void(0)" rel="${id}" class="no">拒绝</a>
<textarea class="txt" id="txt${id}"></textarea>
            </p>
        </div>
    </div>
</div>
% endif
