<%inherit file="/god/_base.htm" />
<%!
from yajl import dumps
from cgi import escape
from model.feed_import import FeedImport, FEED_IMPORT_STATE_INIT
from model.douban import is_rt_by_title
%>
<%def name="htm_head()">
${css.god_autocomplete|n}
<style>
    #tags{
        font-size:16px;
        padding:3px;
        width:90%;
    }
    .redis_cid{
        width:60%;
    }
    .redis_cid span{
        float:left;
        margin-left:27px;
        margin-top:14px;
    }
    #title{
        padding:7px;
        width:90%;
        display:block;
        margin:14px 0;
    }
    .check{
        font-size:16px;
        margin-top:14px
    }
    .check label{
        margin-right:32px
    }
    #txt
    {
        width:90%;
        height:500px;
        padding:3px 7px;
    }
    #okbtn{
        padding:7px 30px;
        margin-top:14px;    
    }
    #nobtn{
        float:right;
        margin-right:10%
    } 
</style>
</%def>

<%
feed = FeedImport.where(state = FEED_IMPORT_STATE_INIT)
result={}
if feed:
    result['id'] = feed[0].id
    result['title'] = feed[0].title
    result['txt'] = feed[0].txt
    result['tags'] = []
    for tag in feed[0].tags.split(','):
        result['tags'].append((tag,0))
    #result['tags'] = feed[0].tags
    result['author_rm'] = is_rt_by_title(feed[0].title) 
    result['url']=feed[0].url

from model.rec_read import REDIS_REC_CID_TUPLE
%>

<script type="text/x-json" id="site_data">
    ${escape(dumps(result))|n}
</script>
<script src="${js.god_autocomplete|n}"></script>
<script id="render_txt" type="text/x-jquery-tmpl">
    <%text>
    <form id="editform" rel="${id}">
    <input id="title" name="title" type="text" value="${title}" />
    <textarea id="txt" name="txt">{{html txt}}</textarea>

<div>
    <label for="tags">标签</label>
    <input id="tags" name="tags" type="text" value="${tags}" />
</div>

    </%text>
   <%text>

    <br/>

<div class="check">
    <input id="sync" name="sync" type="checkbox" />
    <label for="sync">同步</label>

    <input id="author_rm" name="author_rm" type="checkbox"/>
    <label for="author_rm">删除作者</label>
    <a href="${url}" target="_blank">原文链接</a>
</div>
    <input id="" name="id" style="display:none" value="${id}" type="text" />
</form>
</%text>
</script>

<div id="editwrapper">
</div>

<button id="okbtn">确认</button>
<button id="nobtn">跳过</button>

