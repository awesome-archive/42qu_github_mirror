<%!
from model.cid import CID_BUZZ_SYS, CID_BUZZ_SHOW, CID_BUZZ_FOLLOW, CID_BUZZ_WALL, CID_BUZZ_PO_REPLY
from model.zsite import Zsite
from model.buzz import buzz_show as _buzz_show, buzz_unread_count
%>

<%def name="entry_link(entry)">
<a href="${entry.link}">${entry.name}</a>\
</%def>

<%def name="user_link_list(user_list)">
${','.join([entry_link(i) for i in user_list])}
</%def>

<%def name="buzz_render(i)">
<%
cid = i.cid
rid = i.rid
from_list = i.from_list
entry = i.entry
%>
%if cid == CID_BUZZ_SYS:
系统通知
${entry_link(entry)}
%elif cid == CID_BUZZ_SHOW:

%elif cid == CID_BUZZ_FOLLOW:
${user_link_list(from_list)}
关注了
    %if rid == current_user_id:
    您
    %else:
    ${entry_link(entry)}
    %endif
%elif cid == CID_BUZZ_WALL:
<%
to = Zsite.mc_get(entry.to_id)
%>
${user_link_list(from_list)}
给
${entry_link(to)}
<a href="${to.link}${entry.link}">留言</a>
%elif cid == CID_BUZZ_PO_REPLY:
${user_link_list(from_list)}
回复了
    %if entry.user_id == current_user_id:
    你的
    %endif
<a href="/po/${entry.id}">${entry.name}</a>
%endif
</%def>

<%def name="buzz_show(user_id)">
<%
buzz_list = _buzz_show(user_id, 3)
unread = buzz_unread_count(user_id)
%>
%for i in buzz_list:
<p>${buzz_render(i)}</p>
%endfor
<a href="/buzz">未读${unread}条</a>
</%def>
