<%!
from model.reply import STATE_SECRET, STATE_ACTIVE
from zkit.time_format import friendly_time
%>

<%def name="reply_render(i)">


<%
user = i.user
is_apply = i.state==STATE_SECRET
self_say = i.user==current_user
%>

<div>
<a href="${user.link}">${user.name}</a>
%if is_apply:
悄悄说
%endif
:
%if is_owner or not is_apply or (is_apply and self_say):
<pre>${i.htm|n}</pre>
%else:
<span style="color:#999">省略 ${len(i.txt.decode('utf-8','ignore'))} 字 ...</span>
%endif
<div>
${friendly_time(i.create_time)}
<a target="_blank" href="/wall/txt/${i.id}">回复</a>
</div>
</div>

</%def>
