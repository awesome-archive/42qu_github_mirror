<%!
from config import SITE_DOMAIN
from config import SITE_URL
from model.zsite import ZSITE_STATE_APPLY
NAVURL = (
    ( '/i' , "账号"),
    ( '/po/word' , "微博"),
    ( '/po/note' , "文章"),
)
NAVURL_DICT = dict(NAVURL)
%>

<%namespace file="/ctrl/main/_util/htm.htm" name="htm"/>
<%inherit file="_base.htm" />

<%def name="top_notify()">
%if current_user:
%if current_user.state == ZSITE_STATE_APPLY:
<div id="T">请验证邮箱 ，<a href="/verify/mail">点此重发验证邮件</a></div>
%endif
%endif
</%def>

<%def name="nav_index(uri)">
<%
host_now = request.host==SITE_DOMAIN 
uri = request.uri
%>
<li
%if host_now and uri=='/':
class="on"\
%endif
><a href="${SITE_URL}">首页</a></li>\
%if host_now and uri in NAVURL_DICT:
<li class="on" ><a href="${uri}">${NAVURL_DICT[uri]}</a></li>\
%endif
%if zsite:
<li class="on"><a href="${zsite.link}">${zsite.name}</a></li>\
%endif
</%def>

${top_notify()}
<div id="H"><div class="H">
${self.info_box()}
<a href="${SITE_URL}" class="site">${SITE_DOMAIN}</a>
</div></div>


<div id="container">
    <div id="header">
        <div id="nav">
            <ul>${nav_index(request.uri)}</ul>
            <div class="ornament">
                <div class="ornament-left"></div>
                <div class="ornament-right"><div class="ornament-blank"></div></div>
            </div>
        </div>
    </div>

    <div id="main" class="wrap" style="min-height:100px;">
    ${next.body()}
    </div>
</div>

<%def name="info_box()">
%if current_user: 
<%
link = current_user.link
%>
<div class="R">
<a class="DA" rel="PO" href="javascript:void(0)">发布</a>\
<div class="D" id="DPO">
    <a href="/po/note">文章</a>
</div>
<a class="DA" href="javascript:void(0)">版块</a>
<a class="DA" href="/notice">提醒\
<span style="">32</span>\
</a>
<a class="DA" href="javascript:void(0)" rel="MORE">更多</a>\
<div class="D" id="DMORE">
    <a href="/feed">动态</a>
    <a href="${link}">个人</a>
    <a href="${SITE_URL}/i">账号</a>
    <a href="/logout">退出</a>
</div>
</div>
<script>init_D()</script>

%else:
<%htm:form action="/login" id="register-form" className="register" >
    <div class="input-wrapper">
        <label for="mail">邮箱 ...</label>
        <input id="mail" name="mail"  value="" type="text">
    </div>
    <div class="input-wrapper">
        <label for="password">密码 ...</label>
        <input id="password" name="password" value="" type="password">
    </div>
    <button type="submit"><span>开始使用！</span></button>
</%htm:form>
%endif
</%def>
