<%!
from model.ico import ico_url, ICO96_DEFAULT
from config import FS_URL
%>
<%inherit file="/ctrl/_base/zsite.htm" />
<%namespace file="/ctrl/_util/htm.htm" name="htm"/>
<%namespace file="/ctrl/zsite/_util/wall.htm" import="reply_render, reply_textarea"/>
<%namespace file="/ctrl/_util/buzz.htm" import="buzz_show"/>

<%def name="htm_head()">
${css.ctrl_live|n}
</%def>


<%def name="htm_foot()">
<a id="feed_load" href="javascript:void(0)">加载更多</a>
<div id="feed_loading"></div>
<script src="${js.ctrl_live}"></script>
<script src="${js.ctrl_feed}"></script>
</%def>



%if zsite_id == current_user_id:
<div class="live_top G c">
<%htm:form className="G2" action="/po/word" id="po_word_form">
<%
_ico = ico_url(zsite_id) 
%>\
<a id="po_word_ico"
%if _ico:
href="${current_user.link}"><img src="${_ico|n}"></a>\
%else:
href="/i/pic"><img src="${ICO96_DEFAULT|n}"></a>\
%endif
<div class="po_word_out2"><div class="po_word_out1"><div class="po_word">\
<textarea 
class="po_word_txt"
id="po_word_txt" name="txt"></textarea>\
</div></div></div>\
<div id="po_word_btn" class="btns">\
<span id="po_word_tip"></span>\
<span class="btnw"><button class="btn" type="submit">输出</button></span>\
</div>
</%htm:form>
<div class="G2">${buzz_show(zsite_id)}</div>
</div>
%endif
<div id="main">
<div id="feeds">
<input id="begin_id" type="hidden">
</div>
</div>

<%text>
<script id="feed" type="text/x-jquery-tmpl">
<div style="border:1px solid #eee;padding:10px">
    <img src="${pic}">
    <div class="vote${vote_state}" id="vote${id}"><a title="厌倦" class="down" href="javascript:vote_down(${id});void(0)">-</a><span title="好评度" class="num">${vote}</span><a title="喜欢" class="up" href="javascript:vote_up(${id});void(0)">+</a></div>
    <a target="_blank" href="${link}">${name}</a>
    <a target="_blank" href="${zsite.link}">${zsite.name}</a>
    {{if txt}}
        <div>${txt}</div>
    {{/if}}
    <div class="feedbar">
        <a title="回复" target="_blank" class="reply" href="${link}#txt">${reply_count}</a>
    </div>
    <div>
        ${create_time}
        {{if rt_list.length}} ,
        <span>
            {{each rt_list}}
                <a href="${$value.link}" target="_blank">${$value.name}</a>
            {{/each}}
        </span>推荐
        {{/if}}
    </div>
</div>
</script>
</%text>



##<%def name="_style1(i)">
##<%
##feed_zsite = i.zsite
##%>\
##<div style="padding:10px;margin:10px;border:1px solid #eee">\
##<a href="${feed_zsite.link}" target="_blank">${feed_zsite.name}</a> : \
##${caller.body()}\
##</div>\
##</%def>
##
##<%!
##from model.vote import vote_state
##%>
##<%def name="vote(id, num)">
##<%
##state = vote_state(current_user_id, id)
##%>
##<span class="vote${state}" id="vote${id}">
##<a title="厌倦" class="down" href="javascript:vote_down(${id});void(0)">-</a>
##<span title="好评度" class="num">${num}</span>
##<a title="喜欢" class="up" href="javascript:vote_up(${id});void(0)">+</a>
##<a title="转发" id="rt${id}" class="rt" href="javascript:rt(${id});void(0)"></a>
##</span>
##</%def>
##
##<%def name="_style1_1(i)">
##<%
##iid = i.id
##%>
##<%call expr="_style1(i)">
##${caller.body()}\
##<div>\
##<a href="/po/${iid}" target="_blank">${i.reply_count or ''}回复</a>
##${vote(iid, i.vote)}
##</div>\
##</%call>\
##</%def>
##
##<%def name="render_word(i)">
##<%call expr="_style1_1(i)">
##${i.name}
##</%call>
##</%def>
##
##<%def name="render_note(i)">
##<%call expr="_style1_1(i)">
##<a href="/po/${i.id}" target="_blank">${i.name}</a>
##<div>${i.txt}</div>
##</%call>
##</%def>
##
##
##<%!
##from model.cid import CID_WORD,CID_NOTE
##%>
##%for i in entry_list:
##<%
##cid = i.cid
##%>
##%if cid == CID_WORD:
##${render_word(i)}
##%elif cid == CID_NOTE:
##${render_note(i)}
##%endif
##%endfor
