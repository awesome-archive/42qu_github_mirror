<%!
from tornado.escape import json_encode 
from model.motto import motto_get
from model.zsite_fav import zsite_fav_get
from model.po_by_tag import tag_author_list
from yajl import dumps
from cgi import escape
%>
<%inherit file="/ctrl/_base/zsite.htm" />
<%namespace file="/ctrl/_util/site_rec_new.htm" import="site_rec_render"/>
<%def name="htm_head()">
${css.ctrl_zsite_com|n}
${css.ctrl_hero|n}
${css.ctrl_tag_index|n}
<script src=""></script>
</%def>


<style>
#tagbar{
margin:27px 0 0  -7px;
}
#tagbar .xatxt .xa{
display:inline-block;
margin-left:7px;
padding:3px 14px;
border:1px solid #e0e0e0;
background:-moz-linear-gradient(center top , #FCFCFF, #F6F6FF) repeat;
box-shadow:0 1px 0 #FFFFFF inset, 0 1px 0 rgba(150, 150, 255, 0.1);
color:#666666 !important;
text-shadow:0 1px 0 #FFF;
font-size:14px;
background:#fff\9;
filter:progid:DXImageTransform.Microsoft.gradient(startColorStr='#ffffff',EndColorStr='#f3f3f3');
background-image:-webkit-gradient(linear,0 0,0 100%,from(#fff),to(#f3f3f3));
}
.xatagset span {
background: url(http://s.realfex.xxx/img/gif/tagset.gif) no-repeat 50% 50%;
display: inline-block;
height: 18px;
vertical-align: -4px;
width: 39px;
}
#tagbar .xatxt .xa:active{
box-shadow:0 1px 2px rgba(0, 0, 0, 0.3) inset;
}
#tagbar .xatagset {
padding:3px 7px;
padding:2px 7px 4px\9;
margin-left:7px;
font-size:14px;
display:inline-block;
border:1px solid #e0e0e0;
}
#search{
font-size: 13px;
padding-left: 6px;
width: 206px;
color:#999;
}
.search{
margin-top:27px;
}
.search input {
border: 1px solid #DDDDDD;
height: 26px;
line-height: 26px;
vertical-align: middle;
padding: 1px 3px;
}
.search .search_btn {
background: url("http://s.realfex.xxx/img/png/search_btn.png") no-repeat;
border: medium none;
cursor: pointer;
height: 30px;
width: 31px;
}
ul.token-input-list{
border: 1px solid #DDDDDD;
height: 26px !important;
line-height: 26px;
vertical-align: middle;
padding: 1px 3px;
font-size: 13px;
padding-left: 8px;
width: 209px;
color:#999;
margin:0;
display:inline-block;
padding-left:3px;
}
#token-input-search{
height:auto;
height:26px\9;
padding:0;
color:#999;
font-size:13px;
}
div.token-input-dropdown{
width:246px;
box-shadow:-1px 1px 1px #eee;
border:1px solid #eee;
}
div.token-input-dropdown p{
padding:0 3px;
}
.drop_follow_num{
color:#999;
font-family:monospace;
font-weight:normal;
margin-left:7px;
}
.token-input-dropdown-item, .token-input-dropdown-item2{
border-top: 1px solid #EEEEEE;
color: #333333;
font-size: 12px;
padding: 0 10px;
line-height:22px;
}
div.token-input-dropdown ul li.token-input-selected-dropdown-item{
color:#fff;
/*background:#f9f9ff;*/
background:#d20;
}
.tag_wrap{
width:722px;
float:left;
}
.tag_side{
width:250px;
float:left;
position:relative;
padding-left:32px;
overflow:hidden;
margin:0;
}
li.token-input-input-token{
line-height:22px;
margin:0 3px;
}
</style>

<script>
$(function(){
    autocomplete_tag("#search", [], 1)
    function show_placeholder(){
        if(!$('#token-input-search').val().length>0){
            $('.token-input-list').hide()
            $('#search').show()
            $('#token-input-search').unbind('blur')
        }
        if(document.activeElement.id!='token-input-search'){
            $('.token-input-dropdown').hide()
        }
    }
    function show_token_input(){
        $('#token-input-search').focus().blur(show_placeholder).focus(function(){
            if($('#token-input-search').val().length>0)
            $('.token-input-dropdown').show()}
        )
    }
    show_placeholder()
    $('#search').bind('click',function(){
        $(".token-input-list").show()
        $(this).hide()
        if(navigator.userAgent.indexOf("MSIE")>0) { 
            setTimeout(show_token_input,10)
        }else{
            show_token_input()
        }
    })
})
</script>


<%
is_faved = zsite_fav_get(zsite,current_user_id)
%>

<script id="render_txt" type="text/x-jquery-tmpl"><%text>
<pre class="prebody" id="fdtxt${id}">{{html txt}}</pre><div
class="fdbar"><span
class="L"><span
class="fdopt"><a
class="${fav}"
href="javascript:void(0)" rel="${id}"></a><span
class="split">-</span><a
href="javascript:share(${id});void(0)"
class="vote">推荐</a><span
class="split">-</span><a
href="javascript:fcm(${id},${reply_count});void(0)"
class="fcma"><span
class="mr3">{{if reply_count}}${reply_count}{{/if}}</span>评论</a></span></span><a 
target="_blank" href="/${link}">${time}</a><span
class="split">,</span>{{html user_name}}<a
class="aH" href="${link}" target="_blank"></a></div>
</%text></script>

<div class="G">
<div class="com_wrap">
    <h1>${zsite.name}
        <div class="tagtxt" class="">${motto_get(zsite.id)}</div>
</h1>
    



<div class="com_main">
<div id="feeds"><div id="feed_index">
<div class="main_nav">
    <a href="javascript:void(0)" class="${"faved" if is_faved else "fav"} fav_tag"></a>
##<div class="R">\
##<a class="now" href="#">文章</a>\
##<span class="split">-</span>\
##<a href="#">问题</a>\
##<span class="split">-</span>\
##<a href="#">微博</a>\
##<span class="split">-</span>\
##<a href="#">图片</a>\
##<span class="split">-</span>\
##<a href="#">视频</a></div>\

<div class="R c9"><span class="mr3">${total}</span>文章</div>\

</div>
<div id="item_list"></div>

%if page:
${page|n}
%endif
</div>
</div>
</div>
</div>
    <div class="com_side">


<div id="tagbar">
<span class="xatxt">
%if is_faved:
<a class="xa fav_txt" href="javascript:void(0)" >遗忘</a>\
%else:
<a class="xa fav_txt" href="javascript:void(0)" >关注</a>\
%endif
<a class="xa" href="javascript:void(0)">投递</a>\
<a class="xa" href="javascript:void(0)">提问</a>\
</span>\
<a class="xa xatagset" href="javascript:void(0)"><span></span></a>
</div>



<form class="search" action="http://zuroc.42qu.com/q">
<input type="text" style="color:#999" value="搜索此话题下内容 ..." name="q" id="search" autocomplete="off"><input type="submit" class="search_btn" value=""></form>

<div style="font-size:12px;margin-top:19px;">

<%
site_list=tag_author_list(zsite_id)
%>
%if site_list:
<script type="text/x-json" id="site_data">
    ${escape(dumps(site_list))|n}
</script>
%endif


##        ${site_rec_render()}
<div class="buzz_h1" id="rec_title">贡献者</div>
<div class="site_rec" id="rec_wrapper" ></div>
<script id="site_rec" type="text/x-jquery-tmpl">
<%text>
<div class="site_li c" id="rec_${$data[0]}">
{{if $data[3]}}<div class="site_left"><div
class="site_img"><a
target="_blank"
href="${$data[1]}"><img 
class="site_avatar" src="${$data[3]}"></a></div></div><div class="
{{else}}
<div class="site_info_no_img
{{/if}}
site_info">
<span class="site_name"><a target="_top"
id="site_name_a" href="${$data[1]}">${$data[2]}</a></span>
<a id="rec_id${$data[0]}"
{{if $data[7] === true}}
href="${$data[1]}/i" target="_blank"
{{else}}
href="javascript:void(0)"
{{/if}}
class="sitefav${$data[7]}"></a>
<div class="site_bio">
{{if $data[5]==1 && $data[4]}}
<div>${$data[4]}</div>
{{/if}}

{{if $data[6]}}<div>${$data[6]}</div>{{/if}}
</div>
</div>

</div>
</%text>
        </script>


    </div>
</div>


<script id="render_item" type="text/x-jquery-tmpl"><%text>
<div class="readl c">
<a rel="${$data[0]}" href="javascript:void(0)"
id="fav${$data[0]}"
class="fav{{if $data[5]}}ed{{/if}}"></a>
<div id="reado${$data[0]}" class="reado">
<span class="reada">
<span class="title">${$data[1]}</span>
<span class="rtip">${$data[2]}</span>
</span>  
</div>
<div class="zname">
<a href="#" rel="${$data[3]}" class="TPH" target="_blank">${$data[4]}</a>
</div>         
</div>
</%text></script>
<script src="${js.ctrl_render_item}"></script>
<script src="${js.ctrl_tag}"></script>
<script>\
render_note(${json_encode(item_list)|n})
</script>


##{{if site.length}}
##<div class="site_li" id='rec_${site[0]}'>
##    <div class="site_left"><div class="site_img"><a href="${site[1]}"><img class="site_avatar" src="${site[3]}"></a></div></div>
##    <div class="site_info">
##        <span class="site_name"><a target="_top" id="site_name_a" href="${site[1]}">${site[2]}</a></span>
##        {{if site[5] == 3}}
##        <a class="site_fav_a" id="rec_id${site[0]}" href="javascript:fav('${site[0]}')"></a>
##        <div class="site_bio">${site[3]}</div>
##    </div>
##    <div class="delbtn"><a href="javascript:del('${site[0]}')" onclick=""></a></div>
##    {{/if}}
##    {{if site[5] == 1}}
##    <a class="site_fav_a" id="rec_id${site[0]}" href="javascript:follow_a(${site[0]});void(0)"></a>
##    <div class="site_bio">${site[3]}</div>
##</div>
##<div class="delbtn"><a href="javascript:follow_a(${site[0]});void(0)" onclick=""></a></div>
##{{/if}}
##
##</div>
##{{/if}}
