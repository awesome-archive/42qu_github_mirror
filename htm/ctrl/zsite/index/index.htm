<%inherit file="/ctrl/_base/zsite.htm" />
<%!
from model.ico import pic_url as _pic_url, ico_url_with_default
from model.zsite_link import link_id_name_by_zsite_id
from model.career import career_list_all
%>

<%def name="htm_title()">
${zsite.name}
%if motto:
 - ${motto}
%endif
</%def>


<%
is_owner = zsite_id == current_user_id
pic_url = _pic_url(zsite_id)
%>
<h1 class="zsite_title">\
${zsite.name}\
%if motto:
 - ${motto}\
%endif
</h1>

##<p><a href="/following${CID_USER}">关注的人</a></p>
##%for i in follow_list_by_from_id_cid(zsite.id, CID_USER):
##<p><a href="${i.link}" target="_blank">${i.name}</a></p>
##%endfor
##
##
##<p><a href="/follower">被**关注</a></p>
##<p><a href="/po">文章</a></p>

<div class="G">
<%include file="_g1.htm"/>

%if pic_url:
<div class="G3 zsite_pic"><img src="${pic_url}" ></div>\
%elif is_owner:
<div class="G3">\
<a href="/i/pic" style="font-size:16px;display:block;text-align:center;width:707px;padding:194px 0;border:7px solid #000">点此上传本人头像 ,  我们将人工审核</a>
</div>
%endif
<%
txt = zsite.txt
%>

%if txt:
<div class="zsite_txt G3 c">
    <img src=${ico_url_with_default(zsite_id)}>
    <div class="qgif"></div>
    <div class="zsite_txt_div">\
        <pre>${txt}</pre>\
    </div>\
</div>
%endif

</div>

</div></div></div>
<div><div><div>
<%
zsite_link = link_id_name_by_zsite_id(zsite_id)
%>
%if zsite_link:
<div id="zsite_link" class="zsite_link">
%for id, name in zsite_link:
<a href="/link/${id}">${name}</a>\
%endfor
</div>
%endif






<%
from model.cid import CID_WORD, CID_NOTE, CID_QUESTION, CID_ANSWER, CID_PO
from model.po import po_list_count, po_view_list
po_word_list = po_view_list(zsite_id, CID_WORD, is_owner, 1)
po_word_count = po_list_count(zsite_id, CID_WORD, is_owner)
po_note_list = po_view_list(zsite_id, CID_NOTE, is_owner, 6)
po_note_count = po_list_count(zsite_id, CID_NOTE, is_owner)
po_answer_list = po_view_list(zsite_id, CID_ANSWER, is_owner, 6)
po_answer_count = po_list_count(zsite_id, CID_ANSWER, is_owner)
po_question_list = po_view_list(zsite_id, CID_QUESTION, is_owner, 6)
po_question_count = po_list_count(zsite_id, CID_QUESTION, is_owner)
%>

% if po_word_count:
<div class="zsite_block">\
% for po in po_word_list:
<pre class="zsite_word">${po.htm|n}<a href="/${po.id}" class="zsite_reply"></a>\
</pre>\
% endfor
<div class="zsite_num_div">\
<a href="/word" class="num">\
    <span class="now">${po_word_count}</span><b>句微博</b>
</a>
</div>
</div>
% endif

% if po_note_count:
<div class="zsite_block">\
<div class="zsite_ol">\
<ol>\
% for po in po_question_list:
<li><a href="/${po.id}">${po.name}</a></li>\
% endfor
</ol>\
</div>\
<div class="zsite_num_div">\
<a href="/note" class="num">\
    <span class="now">${po_note_count}</span><b>篇文章</b>
</a>
</div>
</div>
% endif

% if po_answer_count:
<div class="zsite_block">\
<div class="zsite_ol">\
<ol>
% for po in po_answer_list:
<li>${po.question.user.link_html|n} : <a href="/${po.id}">${po.question.name}</a></li>\
% endfor
</ol>
</div>\
<div class="zsite_num_div">\
<a href="/answer" class="num">\
    <span class="now">${po_answer_count}</span><b>次回答</b>
</a>
</div>
</div>
% endif

% if po_question_count:
<div class="zsite_block">\
<div class="zsite_ol">\
<ol>
% for po in po_question_list:
<li><a href="/${po.id}">${po.name}</a></li>\
% endfor
</ol>
</div>\
<div class="zsite_num_div">\
<a href="/question" class="num">\
    <span class="now">${po_question_count}</span><b>条问题</b>
</a>
</div>
</div>
% endif



<div class="zsite_block zsite_follow">\


<%
from model.follow import follow_count_by_to_id, follow_count_by_from_id, follow_list_show_by_from_id
following_count = follow_count_by_from_id(zsite_id)
follower_count = follow_count_by_to_id(zsite_id)
follow_list = follow_list_show_by_from_id(zsite_id, 3)
%>
%if follow_list:
<div class="zsite_ico_div">\
%for i in follow_list:
<%
i_career = i.career
%>
<div class="zsite_ico c">
    <img src="${i.ico96}">
    <div><a href="${i.link}" target="_blank">${i.name}</a></div>
    <div>${i_career[0]}</div>
    <div>${i_career[1]}</div>
 </div>
%endfor
</div>\
%endif
<div class="zsite_num_div">\
<a href="/following" class="num"><span class="now">${following_count}</span><b>关注</b></a>
&
<a href="/follower" class="num_normal"><span>${follower_count}</span>粉丝</a>
</div>
</div>









<div class="zsite_foot">
<a href="#T">${request.host}</a>
</div>

<script src="${js.ctrl_zsite|n}"></script>
