<%!
from datetime import datetime
from model.po_question import answer_id_get, po_answer_list
from model.state import STATE_SECRET, STATE_DEL
from model.cid import CID_NOTE
from model.zsite_link import url_or_id
%>
<%inherit file="_po.htm" />
<%namespace file="_vote.htm" import="_vote"/>
<%namespace file="/ctrl/_util/htm.htm" name="htm"/>

<%def name="po_body()">
<%
po_id = str(po.id)
po_state = po.state
zsite_link = zsite.link
%>
<h1>${po.name}</h1>
<pre>\
<p><span><a href="${zsite_link}">${zsite.name}</a> 问: </span></p>\
${po.htm|n}\
<p class="po_bar">\
<span class="L">${_vote(po_id)}</span>\
${datetime.fromtimestamp(po.create_time)} , \
<a class="c0" href="${zsite_link}/tag/${zsite_tag_id}">${tag_name}</a>\
</p>\
<p class="po_bar">\
<span class="L">\
<a href="${po.link_reply}#reply_txt">${po.reply_count or ''}评注</a></span>\
%if can_admin:
<a href="/question/edit/${po_id}">编辑</a>\
%endif
 </p>\
</pre>\
</%def>


<%def name="reply_list()">
<%
po_id = str(po.id)
%>
<div id="reply_list">
%for answer in po_answer_list(po_id):
<%
answer_id = answer.id
user = answer.user
user_id = user.id
%>
<div class="sdw"><div id="answer${answer.id}" class="sd">
<h1>${answer.name}</h1>
    %if answer.cid == CID_NOTE:
<pre>${answer.htm|n}</pre>
    %endif

    <div class="bar">
    %if answer.can_view(current_user_id):
<a href="${user.link}" class="replyer">${user.name}</a> 
<a class="reply_at" href="${answer.link}#reply_txt"></a>
        %if answer.can_admin(current_user_id):
<a href="${answer.link_edit}" class="edit">编辑</a>
        %endif
    %else:
无名氏
    %endif
    </div>
</div></div>
%endfor
</div>

    %if po_state > STATE_SECRET and not answer_id_get(current_user_id, po_id):
<%htm:form id="txt_form" action="/question/${po_id}">\
<textarea id="reply_txt" name="txt"></textarea>\
<div class="btns">\
<span class="btnw"><button class="btn" type="submit">回答</button></span>\
</div>\
</%htm:form>\
    %endif
</%def>
