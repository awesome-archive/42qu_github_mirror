<%inherit file="_po.htm" />
<%namespace file="/ctrl/_util/htm.htm" name="htm"/>
<%namespace file="_vote.htm" import="po_bar_vote"/>
<%!
from model.po_question import answer_id_get
from model.fs import fs_url_jpg
from model.ico import pic_url_bind_with_default
from model.career import career_bind
from model.days import cn_date, cn_weekday, minute2date, minute2time
from zkit.earth import place_name
from model.event import Event, event_joiner_check_count, event_joiner_user_list, event_joiner_user_id_list, EVENT_STATE_DEL, EVENT_STATE_INIT, EVENT_STATE_REJECT, EVENT_STATE_TO_REVIEW, EVENT_STATE_BEGIN, EVENT_STATE_NOW, EVENT_STATE_END
%>
<%def name="po_body()">
<%
id = po.id
event = Event.mc_get(id)
state = event.state
can_admin = event.can_admin(current_user_id)
%>

% if can_admin or state >= EVENT_STATE_BEGIN:
<%
pic_url = fs_url_jpg(162, event.pic_id)
_begin_time = event.begin_time
begin_date = minute2date(_begin_time)
begin_time = minute2time(_begin_time)
_end_time = event.end_time
end_date = minute2date(_end_time)
end_time = minute2time(_end_time)
join_check_count = event_joiner_check_count(id)
join_count = event.join_count
join_list = event_joiner_user_list(id)
career_bind(join_list)
pic_url_bind_with_default(join_list, '219')
price = event.price
reply_count = po.reply_count
%>
%if event.state >= EVENT_STATE_END and not answer_id_get(current_user_id, event.zsite_id):
%if current_user_id in event_joiner_user_id_list(event.id) or current_user_id==event.zsite_id:
<div style="text-align:center;border-bottom:1px dotted 
#ccc;padding-bottom:16px"><a href="#">
%if current_user_id == po.user_id:
点击这里 , 总结活动
%else:
点击这里 , 反馈活动
%endif
</a></div>
%endif
%endif 
<div class="c" id="event_page">
% if pic_url:
    <img src="${pic_url}" id="event_img">
% endif
    <div id="event_txt">
    <div id="po_name">${po.name}</div>

<p>时间<span class="colon">:</span>\
${cn_date(begin_date)} ${cn_weekday(begin_date)}\
</p>\
% if begin_date == end_date:
<p class="ml48">
    % if begin_time == end_time:
${begin_time}
    % else:
${begin_time} - ${end_time}
    % endif
</p>
% else:
${begin_time}</p>
<p class="ml14">至<span class="ml20">\
${cn_date(end_date)} ${cn_weekday(end_date)} ${end_time}</span></p>
% endif

<p class="mt14">地点<span class="colon">:</span>${place_name(event.city_pid)}</p>
<p class="ml48">${event.address}</p>

</div>
</div>

<div class="w721">
<pre class="prebody">\
${po.htm|n}\
<p>联系电话 : ${event.phone}</p>\
<p>交通方式 : ${event.transport}</p>\
<form id="event_join_btn" action="/event/${'check' if can_admin else 'join'}/${id}" ><span class="btnw"><button type="submit">报名${'管理' if can_admin else '参加'}</button></span>\
% if can_admin and join_check_count:
<span id="to_confirm">\
<a href="/event/check/${id}"><span class="mr3">${join_check_count}</span>待确认</a>\
</span>
% endif
% if price:
<span id="price_per">${price} 元 / 人</span>\
% endif
</form>\
<p class="po_bar po_bar1">
% if can_admin:
<a class="L" href="/po/event/${id}">编辑</a>\
% endif
组织者 : <a href="${zsite.link}">${zsite.name}</a></p>\
${po_bar_vote(po)}\
</pre>
<div class="spline">
<span>${join_count}</span> 报名
</div>
<div class="G">

<div class="G3">

<div id="joiner" class="G">
% for i in join_list:
<%
unit, title = i.career
%>
<a href="${i.link}" class="c0">
<div class="G1">
    <img src="${i.pic219}">
    <div>${i.name}</div>
% if unit:
    <div class="tr">${unit}</div>
% endif
% if title:
    <div class="tr">${title}</div>
% endif
</div>
</a>
% endfor
</div>
</div>
</div>



<div class="spline">
% if reply_count:
<span>${reply_count}</span>
% endif
留言
</div>



</div></div></div>



% else:
活动尚未通过审批
% endif

</div>
<script src="${js.ctrl_zsite|n}"></script>
</%def>
