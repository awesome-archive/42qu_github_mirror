<%!
from model.vote import vote_state, vote_count
from model.cid import CID_WORD, CID_NOTE, CID_QUESTION, CID_ANSWER, CID_PHOTO
from datetime import datetime
from model.po import tag_po_classify
%>
<%inherit file="/ctrl/_base/zsite.htm" />
<%def name="htm_head()">
${css.ctrl_tag|n}
</%def>

<a class="back_a"
%if zsite_id == current_user_id:
href="/live"
%else:
href="/"
%endif
></a>


<%def name="type(cid)">
%if cid == CID_WORD:
微博
%elif cid == CID_NOTE:
文章
%elif cid == CID_QUESTION:
问题
%elif cid == CID_ANSWER:
回答
%elif cid == CID_PHOTO:
图片
%else:
未知
%endif
</%def>

<%
is_owner = False
po_list.sort(key=lambda x:x.cid)
po_word_count, po_word_list = tag_po_classify(po_list, CID_WORD, 1)
po_note_count, po_note_list = tag_po_classify(po_list, CID_NOTE, 6)
po_answer_count, po_answer_list = tag_po_classify(po_list, CID_ANSWER, 6)
po_question_count, po_question_list = tag_po_classify(po_list, CID_question, 6)
po_photo_count, po_photo_list = tag_po_classify(po_list, CID_PHOTO, 6)
%>





<div class="po_tag">
<h1><a class="c0" href="${zsite.link}">${zsite.name}</a> : ${tag_name}</h1>
<div class="zsite_ol">
##<ul>
##%for po in po_list:
##<li>${type(po.cid)}<a href="${po.link}">${po.name}</a></li>
##%endfor
##</ul>
${page|n}
</div>
</div>

% if po_word_count:
<div class="zsite_block">\
% for po in po_word_list:
<pre class="zsite_word">${po.htm|n}<a href="/${po.id}" class="zsite_reply"></a>\
</pre>\
% endfor
<div class="zsite_num_div">\
<a href="/word" class="num">\
    <span class="now">${po_word_count}</span><b>句微博</b>
</a>
</div>
</div>
% elif is_owner:
<div class="zsite_block">\
<div class="zsite_num_div">\
<a href="/live" class="num">\
    <span class="now">点击这里</span><b>思绪飘零</b>
</a>
</div>
</div>
% endif

% if po_note_count:
<div class="zsite_block">\
<div class="zsite_ol">\
<ol>
% for po in po_note_list:
<li><a href="/${po.id}">${po.name}</a></li>\
% endfor
</ol>\
</div>\
<div class="zsite_num_div">\
<a href="/note" class="num">\
    <span class="now">${po_note_count}</span><b>篇文章</b>
</a>
</div>
</div>
% endif

% if po_answer_count:
<div class="zsite_block">\
<div class="zsite_ol">\
<ol>
% for po in po_answer_list:
<li>${po.question.user.link_html|n} : <a href="/${po.id}">${po.question.name}</a></li>\
% endfor
</ol>
</div>\
<div class="zsite_num_div">\
<a href="/answer" class="num">\
    <span class="now">${po_answer_count}</span><b>次回答</b>
</a>
</div>
</div>
% endif

% if po_question_count:
<div class="zsite_block">\
<div class="zsite_ol">\
<ol>
% for po in po_question_list:
<li><a href="/${po.id}">${po.name}</a></li>\
% endfor
</ol>
</div>\
<div class="zsite_num_div">\
<a href="/question" class="num">\
    <span class="now">${po_question_count}</span><b>条问题</b>
</a>
</div>
</div>
% endif

% if po_photo_count:
<div class="zsite_block">\
<div class="zsite_ol">\
<ol>
% for po in po_photo_list:
<li><a href="/${po.id}">${po.name}</a></li>\
% endfor
</ol>
</div>\
<div class="zsite_num_div">\
<a href="/photo" class="num">\
    <span class="now">${po_photo_count}</span><b>张图片</b>
</a>
</div>
</div>
% endif
