<%inherit file="/ctrl/_base/zsite.htm" />
<%namespace file="/ctrl/_util/htm.htm" name="htm"/>

<%!
from model.state import STATE_SECRET, STATE_DEL
from datetime import datetime
%>

<%def name="htm_title()">
%if can_view:
${po.name}
%endif
</%def>
<%def name="htm_head()">
${css.ctrl_po|n}
</%def>
<%
po_id = str(po.id)
po_state = po.state
%>


%if can_view:
    ${next.po_body()}
    %for reply in po.reply_list():
<%
user = reply.user
%>
<div id="reply${reply.id}" style="padding:27px">
    <a href="${user.link}" target="_blank">${user.name}</a> :\
    <pre>${reply.htm|n}</pre>
    %if can_admin or reply.can_rm(current_user_id):
        <a href="javascript:rm(${reply.id});void(0)">删除</a> 
    %endif
<a class="reply_at" rel="${user.id}" href="javascript:void(0)">x</a>
</div>
    %endfor

    %if po.state > STATE_SECRET:
<%htm:form id="txt_form" action="/po/reply/${po_id}">
${htm.reply_textarea()}
<div>
<button type="submit">此致 , 敬礼</button>
</div>
</%htm:form>
    %endif
%else:
<style>
.fullscreen p{
line-height:64px
}
.fullscreen{
font-size:16px;text-align:center;margin-top:10%;
}
</style>
<div class="fullscreen">
<p>
    %if po_state == STATE_DEL:
啊 , 被删除了 !!!
    %elif po_state == STATE_SECRET:
机密文件 , 无关人士 , 禁止入内
    %else:
不可见的状态 ${po_state}
    %endif
</p>
<p>
<a href="/">点此返回</a>
</p>
</div>
%endif

<script src="${js.ctrl_po_po}"></script>\
<script src="${js.ctrl_feed}")></script>

