<%inherit file="/ctrl/_base/zsite.htm" />
<%namespace file="/ctrl/_util/htm.htm" name="htm"/>

<%!
from model.state import STATE_SECRET, STATE_DEL
from model.zsite_url import url_or_id
from model.cid import CID_QUESTION, CID_PHOTO
from datetime import datetime
%>

<%def name="htm_title()">
%if can_view:
${po.name} - ${zsite.name}\
%if tag_name:
 - ${tag_name}
%endif 
%endif
</%def>
<%def name="htm_head()">
${css.ctrl_po|n}
</%def>
<%
cid = po.cid
po_state = po.state
%>
%if cid != CID_PHOTO:
<a class="back_a" href="/po/cid/${cid}"></a>
%endif

%if can_view:
<div class="po_page">
<div class="po_body" id="po_body">
${next.po_body()}\
</div>
${self.reply_list()}\
</div>
%else:
<style>
.fullscreen p{
line-height:64px
}
.fullscreen{
font-size:16px;text-align:center;margin-top:10%;
}
</style>
<div class="fullscreen">
<p>
    %if po_state == STATE_DEL:
啊 , 被删除了 !!!
    %elif po_state == STATE_SECRET:
机密文件 , 无关人士 , 禁止入内
    %else:
不可见的状态 ${po_state}
    %endif
</p>
<p>
<a href="/">点此返回</a>
</p>
</div>
%endif

<script src="${js.ctrl_po_po}"></script>\
<script src="${js.ctrl_feed}")></script>

<%def name="reply_list()">
<%
po_id = str(po.id)
%>
<div id="reply_list">
    %for reply in po.reply_list():
<%
user = reply.user
user_id = user.id
%>
<div class="sdw" id="reply${reply.id}"><div class="sd">
    <pre>${reply.htm|n}</pre>
    <div class="bar">
%if can_admin or reply.can_rm(current_user_id):
    <a href="javascript:rm(${reply.id});void(0)" class="rm">删除</a> 
%endif
<a href="${user.link}" class="replyer">${user.name}</a> 
<a class="reply_at" rel="${url_or_id(user_id)}" href="javascript:void(0)"></a>
    </div>
</div></div>
    %endfor
</div>

    %if po.state > STATE_SECRET:
<%htm:form id="txt_form" action="/po/reply/${po_id}">\
${htm.reply_textarea()}
<div class="btns">\
%if cid == CID_QUESTION:
<a class="reply_a" href="${po.link}">回答</a>\
<span class="btnw"><button  type="submit">评注</button></span>\
%else:
<span class="btnw"><button  type="submit">此致 , 敬礼</button></span>\
%endif
</div>
</%htm:form>
    %endif
</%def>
