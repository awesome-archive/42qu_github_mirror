<%inherit file="/ctrl/_base/1.htm" />
<%namespace file="/ctrl/_util/htm.htm" name="htm"/>

<%!
from model.state import STATE_SECRET
from datetime import datetime
from static import css, js
%>

<%def name="htm_title()">
%if can_view:
${po.name}
%endif
</%def>
<%def name="htm_head()">
<script src="${js.note}"></script>
</%def>
<%
can_admin = po.can_admin(current_user_id)
po_id = str(po.id)
%>


%if can_view:
<h1>${po.name}</h1>
<pre>${po.txt}</pre>
<div>${datetime.fromtimestamp(po.create_time)}</div>
<div>
    %if can_admin:
        <a href="/po/edit/${po.id}">编辑</a>
    %endif
</div>
    %for reply in po.reply_list():
<%
user = reply.user
%>
<div id="reply${reply.id}" style="padding:27px">
    <pre>${reply.htm|n}</pre>
    %if can_admin or reply.can_rm(current_user_id):
        <a href="javascript:rm(${reply.id});void(0)">删除</a> 
    %endif
    <a href="${user.link}" target="_blank">${user.name}</a> :\
</div>
    %endfor

    %if po.state > STATE_SECRET:
<%htm:form action="/po/reply/${po_id}">
<textarea name="txt"></textarea>
<div>
<button type="submit">此致 , 敬礼</button>
</div>
</%htm:form>
    %endif
%else:
<div>机密 !!! </div>
<div>无关人士 , 禁止入内</div>
%endif
