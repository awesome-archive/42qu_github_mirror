<%inherit file="/ctrl/_base/zsite.htm" />

<%!
from model.ico import ico_url_with_default
from model.po import PO_CN, PO_EN
from model.site_po import po_count_by_zsite_id
from operator import itemgetter
from model.motto import motto
%>
<%def name="htm_head()">
${css.ctrl_site_index|n}
</%def>

<%def name="htm_title()">
站点
</%def>


<%def name="site_li(site)">
<%
po_count = po_count_by_zsite_id(site.id)
%>
<div class="c site_po">
    <a href="${site.link}"><img src="${ico_url_with_default(site.id)}" class="site_img"></a>
    <div class="site_txt c">
        <div class="po_ti">
            <a href="${site.link}" class="c0">${site.name}</a>
        </div>
        <div class="po_text">
            <span>${motto.get(site.id)}</span>
            <div class="po_num">
<a class="po_no" href="#"><span class="number">96</span><b>关注</b></a>\
%for cid, count in po_count:
<%
en = PO_EN[cid]
cn = PO_CN[cid]
%>\
%if count:
<span class="amp">&amp;</span>\
<a href="${site.link}/${en}"><span class="number">${count}</span><b>${cn|n}</b></a>\
%endif
%endfor
            </div>
        </div>
    </div>
</div>
</%def>
<%
path = request.path
is_my = path.startswith("/my")
%>
<h1>
    <span class="nav">
        <a ${'class="c0"' if not is_my else ''|n} href="/">所有</a><span class="c9 split">-</span><a href="/my" ${'class="c0"' if is_my else ''|n}>我的</a>
    </span>
    <a class="new" href="/new">创建站点</a>
</h1>


<div class="G">
    <div class="G3" id="site_page">
%if total:
        <div class="site_list mt32">
            %for i in page_list:
                ${site_li(i)}
            %endfor
        </div>  
${page|n}
%else:
<div class="none"><p>暂无站点</p><p><a href="/new">点此创建</a></p></div>
%endif
    </div>
</div>


