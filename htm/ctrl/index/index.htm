<%inherit file="/ctrl/_base/1.htm" />
<%namespace file="/ctrl/_util/wall.htm" import="reply_render"/>
<%namespace file="/ctrl/_util/htm.htm" name="htm"/>


%if zsite:
<%
    is_owner = zsite == current_user
%>
    <p>Zsite ${zsite.name}</p>
    %if not is_owner and current_user:
<%!
from model.follow import follow_get, follow_list_by_from_id_cid
from model.zsite import CID_USER
%>
        %if follow_get(current_user.id,zsite.id):
<a href="/unfollow?${_xsrf}">淡忘</a>
        %else:
<a href="/follow?${_xsrf}">关注</a>
        %endif
    %endif
<p>关注的人</p>
%for i in follow_list_by_from_id_cid(zsite.id, CID_USER):
<p><a href="${i.link}" target="_blank">${i.name}</a></p>
%endfor
${wall_row()}
%endif



<%def name="wall_row()">
<%
reply_total = zsite.reply_total
REPLY_LIMIT = 10
%>
<div>${reply_total}留言</div>
<%htm:form action="/wall">
<textarea name="txt"></textarea>
<input type="checkbox" name="secret" id="secret">\
<label for="secret">悄悄话</label>
<button type="submit">此致 , 敬礼</button>
</%htm:form>
%for i in zsite.reply_list(REPLY_LIMIT,0):
    ${reply_render(i)}
%endfor
%if reply_total > REPLY_LIMIT:
    <a href="/wall/-${REPLY_LIMIT}">等等等 ...</a>
%endif
</%def>
