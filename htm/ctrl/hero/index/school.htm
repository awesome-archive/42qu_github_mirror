<%!
from cgi import escape
from yajl import dumps
from model.zsite import Zsite
from zkit.school_university import SCHOOL_UNIVERSITY, SCHOOL_UNIVERSITY_DEPARTMENT_ID2NAME, SCHOOL_UNIVERSITY_DEPARTMENT_ID, SCHOOL_DEGREE
%>
<%inherit file="../base.htm" />
<%namespace file="/ctrl/_util/hero.htm" import="hero_list_with_star"/>
<%namespace file="/_util/_g1.htm" import="school_show"/>
<%def name="head()">
${css.ctrl_school|n}
${css.ctrl_hero_school|n}
<script src="${js.date}"></script>
<script src="${js.school}"></script>
<script src="${js.school_ctrl}"></script>
</%def>

<%text>
<script id="school_tmpl" type="text/x-jquery-tmpl">
<div>
<input type="hidden" class="school_id" name="school_id" value="${school_id}">
<input 
value="{{if name}}${name}{{else}}请选择学校{{/if}}"
autocomplete="off" type="text" class="school"><select 
name="school_department" class="school_department"><option value="0">选择院系</option></select></select><select 
name="school_year" class="school_year"></select><select
name="school_degree" class="school_degree">
<option value="0">选择类型</option>
<option value="1">本科</option>
<option value="2">大专</option>
<option value="3">硕士</option>
<option value="4">博士</option>
<option value="5">博士后</option>
<option value="6">校工</option>
<option value="7">教师</option>
</select><input
id="school_search" type="submit" value="" class="search_btn"><input 
name="is_my" type="checkbox" id="is_my"><label id="is_my_label" for="is_my">追加到我的履历</label>
</div>
</script>
</%text>

<div class="G c">
<div class="G1 f16">
<h2  class="my_career"><a href="${current_user.link}/i/career" class="R">编辑</a>我的履历</h2>
%for id, school_id, school_year, school_degree, school_department, txt in school_tuple:
<div class="school_li c">\
<input type="radio" value="${school_id}/${school_year}/${school_degree}/${school_department}" id="school_li${id}" class="school_li_radio" name="school_li">\
<label for="school_li${id}">\
<div class="school_li_div">
${school_show(school_id, school_year, school_degree, school_department)}
</div>\
</label>\
</div>
%endfor           
</div>
<div class="G3 mb32">
<form style="border-bottom:1px dotted #ccc"  id="school" action="/q/school">\
</form>\
<div class="G">
%if _id and not result:
<div class="G3"><div class="tc" style="font-size:16px;padding:27px;border-bottom:1px dotted #ccc">查无结果</div></div>
%elif result[0] != (year, department, degree):
<style>
.school_split0 .school_split{
margin-top:0;padding-top:0;border-top:0;
}
.school_split0{
margin-top:-12px;
}
</style>
%endif

    %for pos, (i , k_) in enumerate(result):
<%
school_degree_ , school_department_ ,school_year_ = i
%>
<div class="G3 school_split${pos}">
<div class="school_split">
%if any(i):
%if school_department_:
${SCHOOL_UNIVERSITY_DEPARTMENT_ID2NAME[school_department_]} 
%endif
%if school_department_ and school_degree_:
. 
%endif
%if school_degree_:
SCHOOL_DEGREE[school_degree_]
%endif
%if (school_department_ or school_degree_) and school_year_:
.
%endif
%if school_year_:
${school_year_}
%endif
%else:
其它
%endif
</div>
</div>
${hero_list_with_star(Zsite.mc_get_list(k_),3)}
    %endfor


</div>
${page|n}
</div>
</div>

%if _id:
<script type="text/x-json" id="school_data">\
${escape(dumps([school_data]))|n}\
</script>\
%endif
 
<script>
(function(){
    var school_data=$("#school_data"), school_div=$("#school");
    if(school_data[0]){
        load_school(
            school_div,
            $.parseJSON(school_data.html())
        )
    }else{
        school(school_div)
    }

    $(".add_school_a").click(function(){
        school(school_div)
        $('.job_icon').remove()
        $('.job_txt').css({"margin-bottom":"27px"})
        return false
    })
    $(".school_li_radio").click(function(){
        window.location = "/q/school/"+this.value
    }).attr('checked',false).each(function(){
        if(location.pathname.split("-")[0]=="/q/school/"+this.value){
            this.checked = true;
        }
    })
})()
</script>
