<%!
from static import css, js
from model.vote import vote_state
%>
<%inherit file="/ctrl/_base/1.htm" />
<%namespace file="/ctrl/main/_util/htm.htm" name="htm"/>

<%def name="htm_head()">
<script src="${js.ctrl_feed}"></script>
</%def>

<%htm:form enctype="multipart/form-data" action="/po/word">
<textarea name="txt"></textarea>
<button type="submit">提交</button>
</%htm:form>

<%def name="_style1(i)">
<%
feed_zsite = i.zsite
%>\
<div style="padding:10px;margin:10px;border:1px solid #eee">\
<a href="${feed_zsite.link}" target="_blank">${feed_zsite.name}</a> : \
${caller.body()}\
</div>\
</%def>

<%def name="_style1_1(i)">
<%
iid = i.id
state = vote_state(current_user_id, iid)
%>
<%call expr="_style1(i)">
${caller.body()}\
<div>\
<a href="/po/${iid}" target="_blank">${i.reply_total or ''}回复</a>
<span class="vote${state}" id="vote${iid}">
<a title="厌倦" class="decr" href="javascript:vote_decr(${iid});void(0)">-</a>
<span title="好评度" class="num">${i.vote}</span>
<a title="喜欢" class="incr" href="javascript:vote_incr(${iid});void(0)">+</a>
<a title="转发" id="rt${iid}" class="rt" href="javascript:rt(${iid});void(0)"></a>
</span>
</div>\
</%call>\
</%def>

<%def name="render_word(i)">
<%call expr="_style1_1(i)">
${i.name}
</%call>
</%def>

<%def name="render_note(i)">
<%call expr="_style1_1(i)">
<a href="/po/${i.id}" target="_blank">${i.name}</a>
<div>${i.txt}</div>
</%call>
</%def>


<%!
from model.cid import CID_WORD,CID_NOTE
%>
%for i in entry_list:
<%
cid = i.cid
%>
%if cid == CID_WORD:
${render_word(i)}
%elif cid == CID_NOTE:
${render_note(i)}
%endif
%endfor
