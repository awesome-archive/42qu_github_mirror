<%!
from model.cid import CID_INVITE_REGISTER, CID_NOTICE_REGISTER, CID_NOTICE_WALL, CID_NOTICE_WALL_REPLY, CID_INVITE_QUESTION, CID_NOTICE_QUESTION, CID_NOTICE_PAY
from zkit.time_format import friendly_time
from model.money import trade_log
from model.notice import notice_id_count
from yajl import loads
%>
<%namespace file="/ctrl/_util/user.htm" import="user_career_link"/>

<%def name="trade_log_render(rid)">
<%
message = loads(trade_log.get(rid))
title = message.get('title')
url = message.get('url')
%>
%if title or url:
    %if url:
<a href="${url}" target="_blank">\
    %endif
${title or url}\
    %if url:
</a>\
    %endif
%endif
</%def>

<%def name="notice_render(i)">
<%
cid = i.cid
rid = i.rid
from_user = i.from_user
entry = i.entry
%>
<span class="R c9">${friendly_time(i.create_time)}</span>
${user_career_link(from_user)}
%if cid == CID_NOTICE_WALL:
<%
seq = i.seq
%>\
% if seq > 1:
第 ${seq} 次\
% endif
留言 , <a href="${i.link}">点此浏览</a> 
%elif cid == CID_NOTICE_WALL_REPLY:
<%
entry_zsite = entry.zsite_other(current_user_id)
seq = i.seq
%>\
% if seq > 1:
第 ${seq} 次\
% endif
参与 我 与 <a href="${entry_zsite.link}">${entry_zsite.name}</a> 的
对话 , <a href="${i.link}">点此浏览</a>
%elif cid == CID_NOTICE_PAY:
捐赠 ${entry.read_value} 元
${trade_log_render(rid)}
%endif

##%if cid == CID_INVITE_REGISTER:
##邀请你注册
##%elif cid == CID_NOTICE_REGISTER:
##接受你的邀请注册了
##%elif cid == CID_NOTICE_WALL:
##留言 
##%elif cid == CID_NOTICE_WALL_REPLY:
##回复了我的留言
##%elif cid == CID_INVITE_QUESTION:
##邀请你回答<a href="${entry.link}">${entry.name}</a>
##%elif cid == CID_NOTICE_QUESTION:
##接受你的邀请回答了<a href="${entry.link}">${entry.name}</a>
##%endif
</%def>
