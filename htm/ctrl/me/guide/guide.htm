
<%!
from config import LOGO_TEXT, SITE_DOMAIN
from model.ico import ico_url_bind_with_default
from model.career import career_bind
from tornado.escape import json_encode 
from config import FS_DOMAIN
from tornado.escape import json_encode 
from model.user_auth import user_password_verify, UserPassword, user_password_new

from model.user_info import UserInfo, MARRY_ONE
from config import LOGO_TEXT, SITE_DOMAIN
from model.ico import ico_url_bind_with_default
from model.career import career_bind
from tornado.escape import json_encode 
from model.user_auth import user_password_verify, UserPassword, user_password_new
%>

<%inherit file="/ctrl/_base/_reg_base.htm" />
<%namespace file="/ctrl/_util/htm.htm" name="htm"/>

<%def name="H()">
</%def>

<%def name="htm_head()">
<meta name="description" content=" 无数故事，读完后， 一笑而过。下班的地铁，你还是你，我还是我。认识一个人， 要多少缘分？茫茫人海，擦肩而过多少陌生人。42区，这是相遇的地方 ...">
<script src="${js.pid}"></script>
<script src="${js.date}"></script>
<script src="${js.school}"></script>
<script src="${js.school_ctrl}"></script>

${css.ctrl_school|n}
${css.ctrl_me_guide|n}

<script>
$(function(){
    var j=2
    $('.add_job_a').click(function(){
        var block = $(this).parent()
        var job_html = $('.job_block').html()
        block.before('<p>'+job_html+'</p>')
    })
    $('.school_select').live('focus',pop_school)
    $('#txt').elastic()
    $('#mb1').show()
    $('.step_btn').click(function(){
        var num = parseInt($(this).attr('id').substr(4)) + 1
        $('#mb'+(num-1)).hide()
        $('#mb'+num).show()
    })
    $('.school_year').prepend('<option value="">入学年份</option>')
    for(var i=2011;i>1899;i--){
        $('.school_year, .job_begin_year, .job_end_year').append('<option value='+i+'>'+i+'</option>')
    }
    for(var i=1;i<=12;i++){
        $('.job_begin_month, .job_end_month').append('<option value='+i+'>'+i+'</option>')
    }
    var part1 = $('.part1').html(),
    part2 = $('.part2').html()
    $('.part1').append('<input type="hidden" name="univ_id" id="univ_id1" value="" />')
    $('.add_school_a').click(function(){
        var icon = '<span class="job_icon">■</span>'
        if(!$('.part1').find('.job_icon')[0]){
            $('.part1').prepend($(icon))
        }
        var block = $(this).parent()
        block.before('<p>'+icon+part1+'<input type="hidden" name="univ_id" id="univ_id'+j+'" value="" /></p>')
        block.before('<p>'+part2+'</p>')
        $('.school_select:last').attr('id','school_select'+j)
        $('.dep:last').attr('id','dep'+j)
        j++
    })
})
</script>

</%def>


<%def name="h_nav()"></%def>



<div class="head_hint" >
<p class="hint_p p_b">欢迎来到<span class="hint_logo">42区</span> </p>
<p class="hint_p">人生初见 ，故事伊始 ，我们在此相遇相识 ...</p>
<p class="hint_p">首先 ，请您介绍一下自己 :)</p>
</div>

<%htm:form className="form_reg" id="form1">


<%
info = UserInfo.mc_get(zsite_id)
%>
%if not (info and info.sex):
<p class="line">
<label class="label_input" for="mail">性别</label>\
<select name="sex" class="sex_select">
<option value=""></option>
<option ${'selected' if sex==1 else ''} value="1">男</option>
<option ${'selected' if sex==2 else ''} value="2">女</option>
</select>\
<span class="sex_hint">注意 : 创建账号之后 , 无法修改此项</span>
</p>
${errtip.sex|n}
%endif

<p class="line">
<label class="label_input" for="name">名字</label>\
<input class="login_mail" id="name" autocomplete="off" type="text" name="name" value="${name or current_user.name or ''}"></p>
${errtip.name|n}

%if not UserPassword.get(current_user_id):
<p class="line">
<label class="label_input" for="password">密码</label>\
<input class="login_password" id="password" autocomplete="off" type="password" name="password">
</p>
${errtip.password|n}
%endif

<div class="cl btns form_btn">
<span class="L btnw next_btn"><button type="submit" >下一步</button></span>
</div>
</div>

</%htm:form>
<%htm:form className="form_reg" id="form2">
    <p class="part1">
        <input id="school_select1" value="请选择学校" autocomplete="off" type="text" class="school_select">
        <select name="school_year" class="school_year"></select>
    </p>
    <p class="part2">
        <select name="dep" id="dep1" class="dep"><option value=0>选择院系</option></select>
        <select name="school_type" class="school_type">
            <option value="">选择类型</option>
            <option value="1">本科</option>
            <option value="2">大专</option>
            <option value="3">硕士</option>
            <option value="4">博士</option>
            <option value="5">博士后</option>
            <option value="6">校工</option>
            <option value="7">教师</option>
        </select>
    </p>
    <p>
        <a href="javascript:void(0)" class="add_school_a">添加学校</a>
    </p>
    <div class="cl btns">
    <span class="L btnw"><button type="submit" class="step_btn" id="step2">下一步</button></span>
    </div>
</%htm:form>


<%htm:form className="form_reg" id="form3">
    <div class="job_block">
        <div><input class="job_unit" name="job_unit" placeholder="单位"><input class="job_title" name="job_title" placeholder="头衔"></div><input class="job_txt" name="job_txt" placeholder="经历简述 ... ..."><br/>
        <span class="job_begin">
        <select name="job_begin_year" class="job_begin_year"><option value=0> - 年 - </option></select>
        <select name="job_begin_month" class="job_begin_month"><option value=0> - 月 - </option></select>
        </span>-
        <span class="job_end">
        <select name="job_end_year" class="job_end_year"><option value=0> - 年 - </option></select>
        <select name="job_end_month" class="job_end_month"><option value=0> - 月 - </option></select>
        </span>
    </div>
    <p>
        <a href="javascript:void(0)" class="add_job_a">添加经历</a>
    </p>
    <div class="cl btns">
    <span class="L btnw job_next_btn">\
<button type="submit" type="submit" class="step_btn" id="step3">下一步</button>\
</span>
    </div>
</%htm:form>


<%htm:form className="form_reg" id="form4">
    <p class="f14">
        我的座右铭是<input type="text" name="motto" class="motto">
    </p>
    <p class="f14">
        <script>select_birthday("birthday",'00000000')</script>
        <span id="birthday"></span>出生 , 如今<select name="marry" class="marry"><option value="1">尚是单身</option><option value="2">正在恋爱</option><option value="3">已经结婚</option></select>
    </p>
    <p class="p_addr f14">
       现居<script>select_pid("pid_now", 0)</script><span id="pid_now"></span>
    </p>
    <p class="p_addr f14">
       家乡<script>select_pid("pid_home", 0)</script><span id="pid_home"></span>
    </p>
    <p class="f14">我会向别人这样介绍自己</p>
    <textarea class="f14" placeholder="爱吃什么 , 偶像是谁 , 想去的地方 , 追逐的理想 。 人生是一场旅行 ..." name="txt" id="txt" class=""></textarea>
    
    <div class="cl btns">
    <span class="L btnw job_next_btn"><button type="submit">保存</button></span>
    </div>
</%htm:form>


<script>
$("button[type=submit]").attr('disabled',false);
$("input:first").focus().select()
function form(form_id, error){

    $(form_id).submit(function(){
        $(".errtip").hide()
        var self=$(this), btn=self.find("button[type=submit]"),
            id=this.id.slice(4)-0, errtip, error;
        $(btn.blur().attr("disabled",true).css({'background':"#fff","color":"#aaa"})[0].parentNode).after(
            '<span class="form_loading"/>'
        )
        $.post("/j/auth/guide/"+id,self.serialize(),function(o){
            error = o.error
            if(error){
                btn.attr('disabled',false).css({'background':'',"color":''});
                for(var i in error){
                    errtip = $("#errtip_"+i) 
                    errtip.html(error[i])
                    errtip.slideDown()
                }

                $(".form_loading").remove()
                return
            }  


            var next=$("#form"+(id+1));
            if(next[0]){
                self.slideUp()
                next.slideDown()
            }else{
                location="/"
            }
            //$.fancybox.hideActivity();
        })
        return false
    })
}
form("#form1",function(o){

})
form("#form2",function(o){

})
form("#form3",function(o){

})
</script>



