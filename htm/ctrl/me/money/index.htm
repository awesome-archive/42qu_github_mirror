<%!
from datetime import datetime
from model.cid import CID_TRADE_CHARDE, CID_TRADE_WITHDRAW, CID_TRADE_DEAL
from model.money import trade_log
%>
<%inherit file="/ctrl/_base/zsite.htm" />
<p><a href="/money/charge">充值</a></p>
<p><a href="/money/draw">提现</a></p>
<ol>
%for t in trade_list:
<li>
<%
cid = t.cid
state = t.state
from_id = t.from_id
to_id = t.to_id
from_user = t.from_user
to_user = t.to_user
taxes = t.taxes
got = t.got
update_time = datetime.fromtimestamp(t.update_time)
%>
%if cid == CID_TRADE_CHARDE:
充值 ${got} 元，手续费 ${taxes} 元
%elif cid == CID_TRADE_WITHDRAW:
提现 ${got} 元，手续费 ${taxes} 元
    %if state == TRADE_STATE_ONWAY:
    等待
    %elif state == TRADE_STATE_FINISH:
    成功
    %elif state == TRADE_STATE_CANCEL:
    失败：
    ${trade_log.get(t.id)}
    %endif
%elif cid == CID_TRADE_DEAL:
    %if from_id == current_user_id:
    付给 <a href="${to_user.link}">${to_user.name}</a> ${got} 元
    %else:
    收到 <a href="${to_user.link}">${to_user.name}</a> ${got} 元
    %endif
%endif
交易日期 ${update_time}
</li>
%endfor
</ul>
